# Фонарь
Требуется написать управляемый по сети фонарь. Команды управления фонарь
принимает от сервера фонаря. Предполагается, что реализация сервера уже
существует (однако недоступен вам в процессе разработки клиента фонаря). Фонарь
и сервер общаются по Протоколу Управления Фонарем (ПУФ), работающему поверх
соединения TCP.
ПУФ устроен следующим образом. Для изменения состояния фонаря сервер
передает ему команду управления. Все команды передаются в формате json вида:
{
"command" = text,
"metadata" = double
}

ПУФ версии 1 описывает три команды:
- ON (включить фонарь),
- OFF (выключить фонарь)
- COLOR (сменить цвет)

Цвет (при необходимости) кладется в поле метадата.
### Реализация фонаря должна удовлетворять следующим требованиям:
- При запуске фонарь должен запрашивать хост:порт (по умолчанию
127.0.0.1:9999), подсоединяться по TCP и после этого начать
отрабатывать протокол управления.
- При получении данных от сервера фонарь проверяет команду,
и, если она известна, обрабатывает команду, иначе молча ее игнорирует.
- При получении команды ON фонарь включается — опционально.
- При получении команды OFF фонарь выключается.
- При получении команды COLOR фонарь меняет цвет.
- При завершении работы фонарь корректно закрывает соединение
с сервером.
- Реализация фонаря позволяет легко добавлять любые новые команды.
Проработанность обработки исключительных ситуаций (ошибки
установления соединения, обрывы соединения) — опционально.

### Технологические требования:
- Задание принимается в виде готового к выполнению Python-пакета.
Обязательно наличие инструкции по запуску.
- Версия Python — 3.7+.
- Реализация сетевого протокола может быть на aiohttp, tornado или fastapi.

## Установка
[comment]: # (Осуществляется переход на FastAPI. Установка на данный момент недоступна.)
[comment]: # (Задание оформлено в виде Docker-контейнера.)

Для начала скопируйте репозиторий и перейдите в папку с проектом:
```
git clone https://github.com/Jericho-kd/ownscript-lantern.git
cd ownscript-lantern/ownscript_lantern
```

## Использование
Выполните следующую команду для запуска сервера:
```
python3 main.py
```
Откройте окно браузера и введите в адресной строке следующий адрес:
```
http://127.0.0.1:9999/pages/lantern
```
Откроется окно управления фонарем. Теперь можно отправлять на сервер команды следующего формата:
```
{"command":"ON"}  - включить фонарь
{"command":"OFF"} - выключить фонарь
{"command":"COLOR", "metadata":"Yellow"} - сменить цвет фонаря
```

Если введен некорректный формат данных, то вы увидите соответствующее сообщение об ошибке
<!---Выполните следующие команды:
```
docker build . -t lantern_app
docker run -p 9999:9999 lantern_app
```
Сервер запущен

## Использование
Откройте терминал и выполните команду:
```
telnet 0.0.0.0 9999
```
(Вместо адреса 127.0.0.1 используется адрес 0.0.0.0 из-за проблем с мэппингом портов и адресов в Docker-контейнере)

После удачного подключения вы увидите следующее сообщение:
```
Trying 0.0.0.0...
Connected to 0.0.0.0.
Escape character is '^]'.
Please provide data in the following format {"command":"your command", "metadata": "your metadata"}.
Field 'metadata' is optional (only use to switch lantern colors).
```
Вы подключились к серверу. Теперь можно отправлять на сервер команды следующего формата:
```
{"command":"ON"}  - включить фонарь
{"command":"OFF"} - выключить фонарь
{"command":"COLOR", "metadata":"Yellow"} - сменить цвет фонаря
{"command":"END"} - отключиться от сервера
```
(Поле "metadata" в командах ON, OFF, END опционально)--->

## Тестирование
Находится в разработке